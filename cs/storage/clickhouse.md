ClickHouse是一款MPP(Massively Parallel Processing)架构的列式存储数据库.

[ClickHouse到底是什么?凭啥这么牛逼!](https://mp.weixin.qq.com/s/SBrbhGGN3gbKHpn-8nG_-A)

# 核心特性
## MPP
MPP架构是将任务并行的分散到多个服务器和节点上,在每个节点上计算完成后,将各自部分的结果汇总在一起得到最终的结果.采用MPP架
构的数据库称为MPP数据库.

MPP数据库做大数据计算或分析平台非常适合,例如:数据仓库系统,历史数据管理系统,数据集市等.

所以,报表统计分析,运维统计数据,快速生成报表展示都可以使用mpp数据库.

符合几个条件:不需要更新数据,不需要频繁重复离线计算,不需要并发大.

## 列式存储与数据压缩
按列存储与按行存储相比,前者可以有效减少查询时所需扫描的数据量,这一点可以用一个示例简单说明.
假设一张数据表A拥有50个字段A1～A50,以及100行数据.现在需要查询前5个字段并进行数据分析,则可以用如下SQL实现:
```sql
SELECT A1, A2, A3, A4, A5 FROM A
```
如果数据按行存储,数据库首先会逐行扫描,并获取每行数据的所有50个字段,再从每一行数据中返回A1～A5这5个字段.
不难发现,尽管只需要前面的5个字段,但由于数据是按行进行组织的,实际上还是扫描了所有的字段.

如果数据按列存储,就不会发生这样的问题.由于数据按列组织,数据库可以直接获取A1～A5这5列的数据,从而避免了多余的数据扫描.

按列存储相比按行存储的另一个优势是对数据压缩的友好性.
数据中的重复项越多,则压缩率越高, 既然如此,那怎样的数据最可能具备重复的特性呢?
答案是属于同一个列字段的数据,因为它们拥有相同的数据类型和现实语义,重复项的可能性自然就更高.

ClickHouse就是一款使用列式存储的数据库,数据按列进行组织,属于同一列的数据会被保存在一起,列与列之间也会由不同的文件分别保
存(这里主要指MergeTree表引擎).
数据默认使用LZ4算法压缩,在Yandex.Metrica的生产环境中,数据总体的压缩比可以达到8:1(未压缩前17PB,压缩后2PB).
列式存储除了降低IO和存储的压力之外,还为向量化执行做好了铺垫.

## 向量化执行引擎
向量化执行,可以简单地看作一项消除程序中循环的优化.

为了实现向量化执行,需要利用CPU的SIMD(Single Instruction Multiple Data), 即用单条指令操作多条数据.现代计算机系统概念中,它
是通过数据并行以提高性能的一种实现方式(其他的还有指令级并行和线程级并行), 它的原理是在CPU寄存器层面实现数据的并行操作.

ClickHouse目前利用SSE4.2指令集实现向量化执行.

## 多样化的表引擎
与MySQL类似,ClickHouse也将存储部分进行了抽象,把存储引擎作为一层独立的接口.
截至本书完稿时,ClickHouse共拥有合并树,内存,文件,接口和其他6大类20多种表引擎.
其中每一种表引擎都有着各自的特点,用户可以根据实际业务场景的要求,选择合适的表引擎使用.

## 多线程与分布式
如果说向量化执行是通过数据级并行的方式提升了性能,那么多线程处理就是通过线程级并行的方式实现了性能的提升.
由于SIMD不适合用于带有较多分支判断的场景,ClickHouse也大量使用了多线程技术以实现提速,以此和向量化执行形成互补.

## 多主架构
HDFS,Spark,HBase和Elasticsearch这类分布式系统,都采用了Master-Slave主从架构,由一个管控节点作为Leader统筹全局.
而ClickHouse则采用Multi-Master多主架构,集群中的每个节点角色对等,客户端访问任意一个节点都能得到相同的效果.
这种多主的架构有许多优势,例如对等的角色使系统架构变得更加简单,不用再区分主控节点,数据节点和计算节点,集群中的所有节点功能
相同.所以它天然规避了单点故障的问题,非常适合用于多数据中心,异地多活的场景.

