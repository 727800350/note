# 并行与并发
并发和并行是即相似又有区别的两个概念,并行是指两个或者多个事件在同一时刻发生,而并发是指两个或多个事件在同一时间间隔内发生.

在多道程序环境下,并发性是指在一段时间内宏观上有多个程序在同时运行,但在单处理机系统中,每一时刻却仅能有一道程序执行,故微观上这些程序只能是分时地交替执行.
倘若在计算机系统中有多个处理机,则这些可以并发执行的程序便可被分配到多个处理机上,实现并行执行,即利用每个处理机来处理一个可并发执行的程序,这样,多个程序便可以同时执行.

# 进程 Process
- 进程是指在系统中能独立运行并作为资源的分配的基本单位, 他是一组机器指令, 数据和堆栈等组成的, 是一个能独立运行的活动实体
- 多个进程之间可以并发执行和交换信息.
- 一个进程在运行时需要一定的资源, 如CPU, 存储空间及I/O设备等

## 进程的通信方式
主要分为:管道, 系统IPC(包括消息队列, 信号量, 共享存储), SOCKET

### 管道
特性

1. 管道是一种半双工的通信方式, 数据只能单项流动, 具有固定的读端和写端
1. 只能在具有亲缘关系的进程间流动,进程的亲缘关系通常是父子进程或者兄弟进程
1. 它可以看成是一种特殊的文件，对于它的读写也可以使用普通的read、write 等函数。但是它不是普通的文件，并不属于其他任何文件系统，并且只存在于内存中

管道主要分为:

- 普通管道PIPE
- 流管道(`s_pipe`)
- 命名管道(`name_pipe`): 命名管道也是半双工的通信方式,它允许无亲缘关系的进程间进行通信.

```C++
#include <unistd.h>
int pipe(int fd[2]);  // 返回值, 若成功返回0, 失败返回-1
```
- 当一个管道建立时，它会创建两个文件描述符：fd[0]为读而打开，fd[1]为写而打开
- 要关闭管道只需将这两个文件描述符关闭即可。
- 单个进程中的管道几乎没有任何用处。所以，通常调用 pipe 的进程接着调用 fork，这样就创建了父进程与子进程之间的 IPC 通道

#### FIFO
FIFO，也称为命名管道，它是一种文件类型。

特点

1. FIFO可以在无关的进程之间交换数据，与无名管道不同。
1. FIFO有路径名与之相关联，它以一种特殊设备文件形式存在于文件系统中。


- 信号量是一个计数器,用来控制多个进程对资源的访问,它通常作为一种锁机制.
- 消息队列是消息的链表,存放在内核中并由消息队列标识符标识.
- 信号是一种比较复杂的通信方式,用于通知接收进程某个事件已经发生, 信号注册函数
- 共享内存就是映射一段能被其它进程访问的内存,这段共享内存由一个进程创建,但是多个进程可以访问.

进程同步有哪几种机制: 原子操作,信号量机制,自旋锁管程,会合,分布式系统

操作系统中进程调度策略有哪几种? FCFS(First Come First Service),优先级,时间片轮转,多级反馈

进程有哪几种状态?

- 就绪状态:进程已获得除处理机以外的所需资源,等待分配处理机资源
- 运行状态:占用处理机资源运行,处于此状态的进程数小于等于CPU数
- 阻塞状态: 进程等待某种条件,在条件满足之前无法执行

### 线程
- 线程是进程的实体, 是CPU调度和分派的基本单位,它是比进程更小的能独立运行的基本单位.
- 一个进程可以包含若干个线程, 多个线程也可以并发执行
- 将进程作为分配资源的基本单位, 而把线程作为独立运行和调度的基本单位.

`fork` 是昂贵的. fork要把父进程的内存镜像复制到子进程, 并在子进程中复制所有描述符等等.
子进程获取父进程数据空间,堆和栈的副本, 包括缓冲区.

同一进程内的所有线程共享

1. 相同的全局内存(也就是全局变量)
1. 打开的文件(即描述符)
1. 信号处理函数和信号处置
1. 进程指令
1. 大多数数据
1. 当前工作目录
1. 用户ID和组ID
1. All threads share a common heap. so access to the allocator/deallocator must be synchronized.

不过每个线程拥有各自的

1. 线程ID
1. 寄存器集合, 包括程序计数器和栈指针
1. 栈(用于存放局部变量和返回地址)
1. errno. [ref](http://learn.akae.cn/media/ch35s02.html).
	pthread库的函数都是通过返回值返回错误号,虽然每个线程也都有一个errno,但这是为了兼容其它函数接口而提供的,pthread库本身并不使用它.
	所以errno 还是看成同一个进程的所有线程共享一个全局的errno.
1. 信号掩码
1. 优先级

线程同步的方式有哪些?

- 互斥量:采用互斥对象机制,只有拥有互斥对象的线程才有访问公共资源的权限.因为互斥对象只有一个,所以可以保证公共资源不会被多个线程同时访问.
- 信号量:它允许同一时刻多个线程访问同一资源,但是需要控制同一时刻访问此资源的最大线程数量.
- 事件(信号):通过通知操作的方式来保持多线程同步,还可以方便的实现多线程优先级的比较操作, `pthread_cond_signal, pthread_cond_wait`.

分页和分段有什么区别?

- 段是信息的逻辑单位,它是根据用户的需要划分的, 例如程序段, 数据段, 因此段对用户是可见的 ,页是信息的物理单位,是为了管理主存的方便而划分的,对用户是透明的.
- 段的大小不固定,有它所完成的功能决定,页大大小固定,由系统决定
- 段向用户提供二维地址空间,页向用户提供的是一维地址空间
- 段是信息的逻辑单位,便于存储保护和信息的共享,页的保护和共享受到限制.

