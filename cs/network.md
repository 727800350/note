# 物理层
实现比特流的透明传输, 为数据链路层提供数据传输服务

通信子网中通信信道分为两类: 点对点通信与广播信道

网络的物理层和数据链层协议出现两个分支: 基于点对点通信线路和基于广播信道

点对点连接分为: {全双工, 半双工, 单工}, {串行传输, 并行传输}


广域网和局域网在物理层与数据链路层(介质访问控制子层和逻辑链路控制子层)存在较大的区别, 但是在网络层已经高层可以使用共同的协议

物理层不是指与计算机相连的具体物理设备或传输介质.

物理层设计时, 主要考虑如何在连接开放系统的传输介质上传输各种数据的比特流

被传输的二进制代码称为数据, 数据是信息的载体, 数据涉及对事物的表示形式, 信息涉及对数据所表示内容的解释.

信号是数据在传输过程中电信号的表示形式

电话线上的强弱幅度连续变化的电信号称为模拟信号

计算机的电信号: 电压脉冲信号

## 同步技术
通信的双方在时间基准上保持一致, 指两个或两个以上随时间变化的量在变化过程中保持一定的相对关系.

在数字网中,同步是指调整两个数字信号的有效瞬间,使之彼此保持确定的相位关系.依调整对象和控制机理的不同,同步可以分为数字传输中的比特同步,数字复接中的复接同步,数字分接和其他数字设备中的帧同步,以及数字交换中的交换同步. 

当两个设备一起工作并对时间有精确要求的时候,就需要在它们之间进行同步.同步是基于在两个设备之间规定一个共同的时间参考.例如,你想将32轨的音频信号录制在两台16轨磁带机上,则这两个磁带机的磁带传送轴就需要锁定在一起,这个过程就称为同步.如果这两个设备没有进行同步,无论它们开始的时间多么一致,也会由于两台设备机械结构的差异而产生时间漂移.

当两台(或多台)设备进行同步的时候,其中一台称为主机(以其内部发送的时间码为准),而其它的则称为从机.在只有一台从机的时候,同步信号可直接由主机发送给从机,这时,从机的时钟方式要打到"外部时钟方式"(External Clock Mode).有多台从机时,则需一个专门产生同步信号的设备作为主机,以便多台从机进行同步.

"同步通信"的通信双方必须先建立同步,即双方的时钟要调整到同一个频率.收发双方不停地发送和接收连续的同步比特流.但这时还有两种不同的同步方式.一种是使用全网同步,用一个非常精确的主时钟对全网所有结点上的时钟进行同步.另一种是使用准同步,各结点的时钟之间允许有微小的误差,然后采用其他措施实现同步传输.

异步通信也可以是以帧作为发送的单位.接收端必须随时做好接收帧的准备.这时,帧的首部必须设有一些特殊的比特组合,使得接收端能够找出一帧的开始.这也称为帧定界.帧定界还包含确定帧的结束位置.这有两种方法.一种是在帧的尾部设有某种特殊的比特组合来标志帧的结束.或者在帧首部中设有帧长度的字段.需要注意的是,在异步发送帧时,并不是说发送端对帧中的每一个字符都必须加上开始位和停止位后再发送出去,而是说,发送端可以在任意时间发送一个帧,而帧与帧之间的时间间隔也可以是任意的.在一帧中的所有比特是连续发送的.发送端不需要在发送一帧之前和接收端进行协调(不需要先进行比特同步).

异步通信的好处是通信设备简单,便宜,但传输效率较低(因为开始位和停止位的开销所占比例较大).

计算机的通信过程与人们使用电话进行通话的过程有很多相似之处. 在正常的通话过程中, 人们在拨通电话并确定对方是要找的人时, 双方就可以进入通话状态. 在通话过程中, 说话的人要讲清楚每一个字, 没讲完一句话需要停顿一下. 听话的人也要适应讲话人的说话速度, 听清对方的每一个字, 并根据讲话人的语气和挺短判断一句话的开始于结束, 这样才可能听懂对方所说的每句话, 这就是人们在电话通信中需要解决的"同步" 问题. 如果在数据通信过程中, 首发双方同步不良, 就会影响通信质量.

在数据通信过程中, 收发双方同样要解决同步问题, 但是问题更加复杂一些.

数据通信的同步包括以下两种类型: 

位同步bit synchronous

要求接收端根据发送端发送数据的时钟频率与比特流的起始时刻, 校正自己的时钟频率

外同步法: 发送数据信号的同时, 另外发送一路同步信号

内同步法: 从自含时钟编码的发送数据中提取同步时钟, (差分)曼彻斯特编码

字符同步character synchronous

同步式, 同步传输

将字符组织成以组为单位发送, 每组字符前加上一个或多个用于同步控制的同步字符SYN. 接受端接收到同步字符SYN后, 根据SYN来确定数据字符的起始与终止

异步式, 异步传输

每个字符作为一个独立的整体进行发送, 字符之间的时间间隔是任意的. 在每个字符的第一位加1为起始位(逻辑1), 字符的最后一位后加1或2位终止位(逻辑0)


数据编码技术

模拟数据编码

数字数据编码

非归零码NRZ

曼彻斯特编码

差分曼彻斯特编码



脉冲编码调制pulse code modulation, PCM

是模拟数据数字化的主要方法

采样, 量化和编码

## 基带传输技术
基本频率分量对应的矩形脉冲信号称为基本频带(简称为基带)

信源(信息源,也称发终端)发出的没有经过调制(进行频谱搬移和变换)的原始电信号所固有的频带(频率带宽),称为基本频带,简称基带.

傅里叶级数

时域方法: 示波器

频域方法: 频谱仪

带宽(band width)又叫频宽,是指在固定的的时间可传输的资料数量,亦即在传输管道中可以传递数据的能力.在数字设备中,频宽通常以bps表示,即每秒可传输之位数.在模拟设备中,频宽通常以每秒传送周期或赫兹 (Hz)来表示.

奈奎斯特准则指出: 二进制数据信号的最大数据传输速率R_{max} 与理想信道带宽B(B=f, 单位为Hz) 的关系: R_{max} = 2f (bps)

信噪比

信号功率与噪声功率之比的简称

想弄定律指出: 在有随机热噪声的信道中传输数据信号时, 传输速率R_{max} 与信道带宽B, 信噪比S/N的关系为:

R_{max} = B * log_2{1 + S/N}

利用模拟信道传输数据信号的方法称为频带传输

调制解调器

## 多路复用技术
multiplexing

发送方将多个用户的数据通过复用器(multiplexer) 进行汇集, 并将汇集后的数据通过一条物理线路传输到接收方, 接收方通过分用器(demultiplexer) 将数据分离成各个单独的数据, 然后再分发给接收方的多个用户.

具备复用器与分用器的设备称为多路复用器

频分多路复用 frequency division multiplexing, FDM

	载波带宽被划分为多种不同频带的子信道,每个子信道可以并行传送一路信号

波分多路复用 wavelength division multiplexing, WDM

	光的频分多路复用

时分多路复用 time division multiplexing, TDM

	按传输信号的时间进行分割的,它使不同的信号在不同的时间内传送,将整个传输时间分为许多时间间隔(Slot time,TS,又称为时隙),每个时间片被一路信号占用.

	同步时分多路复用: 严格固定时间片

	统计时分多路复用: 动态划分

# 数据链路层
## 差错产生与控制方式
在原始的物理传输线路上传输数据信号是有差错的.

物理传输线路是指没有采用高层差错控制的基本物理传输介质与设备.

设计数据链路层: 在原始的, 有差错的物理传输线路的基础上, 采取差错检测, 差错控制与流量控制等方法, 将有差错的物理线路改进成逻辑上无差错的数据链路层, 以便向网络层提供高质量的服务.

热噪声: 传输介质导体的电子热运动, 时刻存在, 幅度小, 强度与频率无关, 频谱很宽, 随机

冲击噪声: 外界地磁干扰

检错码: 为每个传输的分组加上一定的冗余信息

纠错码: 为每个传输的分组加上足够多的冗余信息, 以便能够在接收端能发现并自动纠正传输差错

### 循环冗余编码工作原理CRC
Cyclic redundancy code

差错校验码

循环冗余码CRC在发送端编码和接收端校验时,都可以利用事先约定的生成多项式G(X)来得到

k位要发送的信息位可对应一个(k-1)次多项式K(X),

r位冗余位对应于一个(r-1)次多项式R(X),

由k位信息位后面加上r位冗余位组成的n=k+r的码字则对应于一个(n-1)次多项式T(X)X×K(X)+R(X).

也即在发送端产生一个循环冗余码,附加在信息位后面一起发送到接收端.

接收端的检验过程就是将接收到的码字多项式除以G(X),若余式为零则认为传输无差错,若余式不为零则传输有差错.

例子:

1. 发送数据比特序列: 110011
2. 生成多项式为11001	(5bits, x^4+x^3+1)
3. 将发送数据乘以2^4,也即左移4bit, 得到1100110000
4. 将乘积用生成多项式比特序列去除, 按模二算法, 得到余数为1001
5. 将余数比特序列替换原始发送数据左移后多出的4个0, 得到110011,1001 (传输序列)
6. 如果在数据传输过程中没有发生错误, 接收端收到的带有CRC校验码的数据比特序列一定能被相同的生成多项式整除,即1100111001÷11001 余数为0

### 差错控制机制
反馈重发机制ARQ

Automatic request for repeat

如果数据传输正确, 接收端通过反馈信号控制器向发送端发送"传输正确ACK"信息.

反之, 反馈传输错误NAK 信息

最大重发次数

反馈重发机制的分类
反馈重发纠错实现方法有两种:停止等待方式和连续工作方式.
(1)停止等待方式
(2)连续工作方式
连续工作方式又分为两种类型:拉回方式和选择重发方式.

## 基本概念
链路管理

数据链路的建立, 维持和释放

帧同步

接收方能从收到的比特流中正确的判断出一帧的开始位和结束位

透明传输

透传的设备是个黑盒子, 进来什么出去什么

当传输的数据帧中出现控制字符时, 就必须采取适当的措施, 使接收方不至于将数据误认为是控制信息

寻址

保证每一帧能传送到正确的目的结点, 接收方也应该知道发送方是哪个节点

## 面向比特型数据链路层协议
高级数据链路控制协议 high level data link control, HDLC

### HDLC的帧结构

0比特插入/删除

该法在发送端监视除标志码以外的所有字段,当发现有连续5个"1"出现时,便在其后添插一个"0",然后继续发后继的比特流.在接收端,同样监除起始标志码以外的所有字段.当连续发现5个"1"出现后,若其后一个比特"0"则自动删除它,以恢复原来的比特流,若发现连续6个"1",则可能是插入的"0"发生差错变成的"1",也可能是收到了帧的终止标志码.后两种情况,可以进一步通过帧中的帧检验序列来加以区分."0比特插入法"原理简单,很适合于硬件实现.

标志字段: 为01111110的比特模式,用以标志帧的起始和前一帧的终止.标志字段也可以作为帧与帧之间的填充字符.

地址字段: 命令帧中的地址字段携带的是对方站的地址,而响应帧中的地址字段所携带的地址是本站的地址

控制字段(C) 1B

控制字段用于构成各种命令和响应,以便对链路进行监视和控制.

发送方主站或组合站利用控制字段来通知被寻址的从站或组合站执行约定的操作,相反,从站用该字段作对命令的响应,报告已完成的操作或状态的变化.

该字段是HDLC的关键.

控制字段中的第一位或第一,第二位表示传送帧的类型,HDLC中有三种

信息帧(I帧information)第1位为"0"

监控帧(S帧supervision)第1,2位为"10"

无编号帧(U帧unnumbered)"11"是无编号帧

控制字段的第五位是P/F位,即轮询/终止(Poll/Final)位.

信息帧中,234位为存放发送帧序号,5位为轮询位,当为1时,要求被轮询的从站给出响应,678位为下个预期要接收的帧的序号.

监控帧中,34位为S帧类型编码.第5位为轮询/终止位,当为1时,表示接收方确认结束.

无编号帧,提供对链路的建立,拆除以及多种控制功能,用34678这五个M位来定义,可以定义32种附加的命令或应答功能.


信息帧

N(S) 为当前发送的信息帧的序号

N(R) 表示该站已正确接收序号为N(R) -1 的帧及以前各帧, 期望下次接收序号N(R) 的帧. 带有捎带确认的意思

由于是全双工通信, 因此通信双方各有一个N(S)及N(R)



探寻/终止位(poll/final)的意义

0,表示没有意义

P/F =1(询问),如果从站有帧发送,则可以向主站发送

F=1(终止),发送的最后一帧,表示从站已经发送结束

P=1和F=1在帧交换过程中成对出现

监控帧

确认作用和流量控制作用

无编号帧

控制作用

### Undone 数据链路层的工作过程
## Internet 中的数据链路层
Internet 数据链路层主要有两种:

	串行线路IP协议 serial line IP, SLIP, 特简单

	点对点协议 point to point protocol PPP

### PPP协议
解决了SLIP一些固有的效率问题, 它支持异步传输链路(面向字符的链路)与同步传输链路(面向比特的链路), 还支持IP协议机其他网络层协议

PPP协议提供一下几种功能

用于串行链路的基于HDLC数据链路帧封装机制

链路控制协议link control protocol LCP 用于建立, 配置, 管理和测试数据链路连接

网络控制协议network control protocol NCP用于建立和配置不同的网络层协议


每个端节点首先发送LCP数据帧, 以配置和测试PPP数据链路.

当PPP链路建立起来后, 每个端节点发送NCP数据帧, 以选择和配置网络层协议

当网络层协议配置好之后, 网络层的数据报就可以通过PPP信息帧传输

## HDLC and PPP
HDLC使用时是私有的,即与厂商有关,一般用在专线.

PPP也用HDLC封装数据,但还加了对上的NCP和对下的LCP,用于上下层兼容,所以兼容性好,支持认证,压缩,多链路等,用于专线和拨号都行.

HDLC使用时是cisco私有的协议,该协议仅适合cisco设备间互连用,不能用于其他设备

不同品牌的设备要想连通,封装最好用PPP

思科的HDLC是私有的,PPP才是公用的标准.

## Ethernet局域网
Ethernet的核心技术是随机争用型介质访问控制方法, 既带有冲突检测的载波侦听多路访问(carrier sense multiple access with collision detection, CSMA/CD) 方法.

它的核心技术起源于无线分组交换网-ALOHA网

ALOHA网络的通信协议很简单, 网络中任何结点都可以随时发送数据. 数据发送后等待确认. 如果在一段时间(200~1500ns) 内没有收到确认, 这个结点就认为有另一个或多个结点在同一时刻也在进行数据传送, 也就是出现"冲突". 冲突导致多路数据的叠加, 叠加后的信号波形将不等于任何一路发送的信号波形, 因此接收点不可能接收到有效的数据信号, 这样多个结点发送都失败. 这时, 发生冲突的多个结点需要各自随机后退一个延迟时间, 并再次发送数据, 直到成功发送为止.

Ethernet: 改进ALOHA网络, 冲突检测, 载波侦听和随机后退算法

# 网络层
路由选择, 拥塞控制与网络互联

异构性网络

网络, 通信协议, 计算机硬件和操作系统的差异性

## IP地址
IPv4 32bits

一个IP地址是与一个网络接口相关联的, 而不是笼统的指一台接入网络的主机或路由器

### 子网与超网
主机号全是0,表示这个子网, 全是1 表示广播地址

子网掩码subnet mask

划分子网:

一个公司获得一个A类地址121.0.0.0, 组建至少1000个子网

如果选择子网号的位长为9, 那么子网总数可以达到2^9 = 511, 不够, 所以子网号为10位.

2^10 = 1024, 但是子网号全为0或者全为1, 分别表示这个网络的地址和广播地址

所以共有1022个子网

对于A类地址, netID为8位(第一位为0)

那么经分析: netID 8 位, subnetID 10位, hostID 32-8-10=14位

特殊地址: 121.0.0.0 ~ 121.0.63.255 

01111001,00000000,00000000,00000000 ~ 01111001,00000000, 01111111,11111111

子网1: 121.0.64.1 ~ 121.0.127.254 

01111001,00000000,01000000,00000001 ~ 01111001,00000000,01111111,11111110

子网2: 121.0.128.1 ~ 121.0.191.254 

01111001,00000000,10000000,00000001 ~ 01111001,00000000,10111111,11111110

….etc^

子网1022: 121.255.128.1 ~ 121.255.191.254 

01111001, 11111111,10000000,00000001 ~ 01111001, 11111111,10111111,11111110

子网掩码: 255.255.192.0

	11111111,11111111,11000000,00000000

网络地址:121.0.0.0

最长掩码匹配

192.168.20.16/28   192.168.0.0/16  在要查找地址192.168.20.19的时候,这两个表项都"匹配".也就是说,两个表项都包含着要查找的地址.这种情况下,掩码最长的路由就是192.168.20.16/28,因为它的子网掩码(/28)比其他表项的掩码(/16)要长,使得它更加明确.

路由表中常常包含一个默认路由.这个路由在所有表项都不匹配的时候有着最短的掩码匹配.

在Unix中,gateway是路由器的同义词,数值0.0.0.0表示直接诶交付

无类域间路由CIDR技术

斜线记法 <络前缀>,<主机号> 

200.16.23.0/20 表示在32位中, 20位是前缀

无分类IP地址

x,y,z,t/n

n表示这个地址块中最左边的n位是相同的

专用IP地址

类	地址范围	总数

A	10.0.0.0 ~ 12.255.255.255	1

B	172.16.0.0 ~ 172.31.255.255	16

C	192.168.0.0 ~ 192.168.255.255	256

## IP协议
一个网络系统内部的分组交换量占到80%, 这样的分组交换任务由第三层交换机完成.
而20%左右的与外部的通信量由路由器完成, 这样一个合理的分工可以提高系统整体的效率

## ICMP协议
Internal control message protocol

ICMP的差错与查询, 控制功能对于保证IP协议的可靠运行是至关重要的

ICMP报文不是直接传送给数据链路层, 而是要封装成IP数据报, 然后才传送到数据链路层



ICMP差错控制功能

目的站不可达 destination unreachable

源站抑制

超时

参数问题报告

改变路由

IP多播

IP多播(也称多址广播或组播)技术,是一种允许一台或多台主机(多播源)发送单一数据包到多台主机(一次的,同时的)的TCP/IP网络技术.多播作为一点对多点的通信,是节省网络带宽的有效方法之一.在网络音频/视频广播的应用中,当需要将一个节点的信号传送到多个节点时,无论是采用重复点对点通信方式,还是采用广播方式,都会严重浪费网络带宽,只有多播才是最好的选择.多播能使一个或多个多播源只把数据包发送给特定的多播组,而只有加入该多播组的主机才能接收到数据包.目前,IP多播技术被广泛应用在网络音频/视频广播,AOD/VOD,网络视频会议,多媒体远程教育,"push"技术(如股票行情等)和虚拟现实游戏等方面.

D类地址是为IP多播地址定义的

## IGMP协议

Internet 组管理协议IGMP 是在多播环境下使用的协议

多播路由器

IP多播中的隧道技术

	遇到不支持多播协议的路由器时使用

	对多播分组进行再次封装, 加上普通IP分组头, 然后成为向单一目的站发送的单播

## IPv6

128 bits, 但是IPv6 的分组头长度仅是IPv4 分组头部长度的2倍

	每16位划分为一个位段,用两个十六进制数表示

	前缀表示法

IPv4使用动态主机配置协议, 而IPv6支持地址自动配置

IPv6地址分为单播地址, 组播地址, 多播地址与特殊地质

