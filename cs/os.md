# 操作系统引论
计算机硬件和软件资源: 处理器, 存储器, I/O设备和信息(程序和数据)

通常把覆盖了软件的机器称为扩充机器或虚机器.它向用户(进程)提供了一个对硬件操作的抽象模型,用户可利用抽象模型提供的接口使用计算机,而无需了解物理接口实现的细节


20世纪60年代中期,在前述的批处理系统中,引入多道程序设计技术后形成多道批处理系统(简称:批处理系统).

Multiprogrammed batch processing system

它有两个特点:

1. 多道:系统内可同时容纳多个作业.这些作业放在外存中,组成一个后备队列,系统按一定的调度原则每次从后备作业队列中选取一个或多个作业进入内存运行,
	运行作业结束,退出运行和后备作业进入运行均由系统自动实现,从而在系统中形成一个自动转接的,连续的作业流.
2. 成批:在系统运行过程中,不允许用户与其作业发生交互作用,即:作业一旦进入系统,用户就不能直接干预其作业的运行.

批处理系统的追求目标:提高系统资源利用率和系统吞吐量,以及作业流程的自动化.

批处理系统的一个重要缺点:不提供人机交互能力,给用户使用计算机带来不便.


SPOOLing (即外部设备联机并行操作),即Simultaneous Peripheral Operation On-Line的缩写,它是关于慢速字符设备如何与计算机主机交换信息的一种技术,通常称为"假脱机技术".

"假脱机真联机",他的核心思想是以联机的方式得到脱机的效果.

spooling系统的三大组成部分:

1. 输入井和输出井
2. 输入缓冲和输出缓冲
3. 输入进程SPi和输出进程SPo

SPOOLing 技术实际上是一种外围设备同时联机操作技术,又称为排队转储技术.

它在输入和输出之间增加了"输入井"和"输出井"的排队转储环节.

若有进程要求对它打印输出时,SPOOLing系统并不是将这台打印机直接分配给SPOOLING

进程,而是在共享设备(磁盘或磁鼓)上的输出SPOOLing存储区中为其分配一块存储空间,进程的输出数据以文件形式存放于此.
各进程的数据输出文件形成了一个输出队列,由输出SPOOLing系统控制这台打印机进程,依次将队列中的输出文件实际打印输出.
在SPOOLing 系统中,实际上并没有为任何进程分配,而只是在输入井和输出井中,为进程分配一存储区和建立一张I/O请求表.这样,便把独占设备改造为共享设备.

虚拟内存是计算机系统内存管理的一种技术.它使得应用程序认为它拥有连续的可用的内存(一个连续完整的地址空间),
而实际上,它通常是被分隔成多个物理内存碎片,还有部分暂时存储在外部磁盘存储器上,在需要时进行数据交换.

分时操作系统 (time-sharing system)

分时是指多个用户分享使用同一台计算机的硬件和软件资源.

多终端和显示器

多用户,以交互方式使用计算机

分为三类:单道分时操作系统,多道分时操作系统,具有前台和后台的分时操作系统.

分时操作系统将CPU的时间划分成若干个片段,称为时间片.操作系统以时间片为单位,轮流为每个终端用户服务.

脱机处理

这里的机是指主机

脱机处理时,外部设备上的数据需要一个相当长的等待时间后才被进行处理.当外部设备上有数据输入时,主机并不予处理,只是将外部设备的数据存放到缓冲区中.
一旦缓冲区满了,或是等待的时间到了,主机才进行加工处理.

对输出的操作也是这样,一旦计算机要把处理结果输出,它只是把输出结果送入缓冲区中,然后向外部设备慢慢地进行输出,而主机又去进行其它的加工处理,
当缓冲区中的数据全部输出完毕,主机再把下一批的数据存入缓冲区中.

在输入数据时,如果要对数据进行合法性验证,就应考虑采用联机处理的方式,以便及时发现输入数据的错误,并及时予以更正.
如果是从网上或磁盘中把数据读出来,则可考虑用脱机处理的方式,因为对这些输入的数据可以不进行合法性校验,只是进行再加工和处理.

分时系统中的多路卡: 使主机能同时接收各用户从终端输入的数据

# 操作系统的基本特性
## 并发
并行与并发

并发和并行是即相似又有区别的两个概念,并行是指两个或者多个事件在同一时刻发生,而并发是指两个或多个事件在同一时间间隔内发生.

在多道程序环境下,并发性是指在一段时间内宏观上有多个程序在同时运行,但在单处理机系统中,每一时刻却仅能有一道程序执行,故微观上这些程序只能是分时地交替执行.
倘若在计算机系统中有多个处理机,则这些可以并发执行的程序便可被分配到多个处理机上,实现并行执行,即利用每个处理机来处理一个可并发执行的程序,这样,多个程序便可以同时执行.

进程 Process

进程是指在系统中能独立运行并作为资源的分配的基本单位, 他是一组机器指令, 数据和堆栈等组成的, 是一个能独立运行的活动实体

多个进程之间可以并发执行和交换信息.

一个进程在运行时需要一定的资源, 如CPU, 存储空间及I/O设备等



线程

由于进程拥有自己的资源, 故调度进程付出的开销较大

一个进程可以包含若干个线程, 他们可以利用进程所拥有的资源.

将进程作为分配资源的基本单位, 而把线程作为独立运行和多利调度的基本单位.

由于线程比进程小, 基本上不拥有系统资源, 故对它的调度付出的开销就会小得多



## 共享性
资源共享或称为资源复用

互斥共享方式: 在一段时间内只允许一个进程访问的资源称为临界资源或独占资源

同时访问方式: 这里的同时在单处理机上往往是指宏观的

并发和共享是操作系统的两个最基本的特性,它们又是互为存在条件.
一方面资源共享是以程序(进程)的并发性执行为条件的,若系统不允许程序并发执行,自然不存在资源共享问题.
另一方面若系统不能对资源共享实施有效管理,则也必将影响到程序并发执行.你想想自己用的操作系统,如果不能并发,你每次只能打开一个程序,要打开另外一个就得关闭前一个,多痛苦.
而你打开多个程序的时候不可避免会用到同一个资源.

## 虚拟技术
时分复用技术, 即分时使用技术

	虚拟处理机技术 虚拟设备技术

空分复用技术

	虚拟磁盘技术	虚拟存储器技术

## 异步性
所谓异步性是指:进程以不可预知的速度向前推进.内存中的每个进程何时执行,何时暂停,以怎样的速度向前推进,每道程序总共需要多少时间才能完成等,都是不可预知的.

尽管如此,但只要在操作系统中配置有完善的进程同步机制,且运行环境相同,作业经多次运行都会获得完全相同的结果.因此,异步运行方式是允许的.

# 操作系统的主要功能
处理及管理, 存储器管理, 设备管理和文件管理	

## 处理器管理功能
进程控制

进程同步

	进程互斥方式: 锁

	进程同步方式: 信号量

进程通信: 消息

调度

	作业调度

	(线程)进程调度

## 存储器管理功能
内存分配

	静态和动态

内存保护

	彼此互不干涉, 方法:界限寄存器(通常用硬件实现)

地址映射

	逻辑地址和物理地址

内存扩充

	虚拟存储技术

		请求调入功能

		置换功能

## 设备管理功能
缓冲处理

	单缓冲机制, 双缓冲机制, 缓冲池

设备分配

设备处理: 设备处理程序(又称为设备驱动程序)

	设备和CPU之间的通信通过设备处理程序

虚拟设备

## 文件管理功能
文件存储空间的管理

目录管理

文件的读/写管理和保护

# OS结构设计
无结构操作系统

模块化结构OS

	模块-接口法

		内聚性: 模块内部各部分间联系的紧密程度

		耦合度: 模块间

分层式结构OS

自底向上铺设中间层

每一层仅能使用其底层所提供的功能和服务



微内核OS结构

Micro kernel

能有效地支持多处理机运行, 故非常适合于分布式系统环境

Windows 采用了微内核结构

微内核和多个服务器   客户/服务器模式

1) 足够小的内核

内核是指精心设计的, 能实现现代OS 最基本的核心功能的部分.

微内核并非是一个完整的OS, 而只是操作系统中最基本的部分

它通常用于

	实现与硬件紧密相关的处理

	实现一些基本的功能

	负责客户和服务器之间的通信

2) 基于客户/服务器模式

由于客户/服务器(Client/Server)模式,具有非常多的优点,故在单机微内核操作系统中几乎无一例外地都采用客户/服务器模式,将操作系统中最基本的部分放入内核中,而把操作系统的绝大部分功能都放在微内核外面的一组服务器(进程)中实现.例如用于提供对进程(线程)进行管理的进程(线程)服务器,提供虚拟存储器管理功能的虚拟存储器服务器,提供I/O设备管理的I/O设备管理服务器等,它们都是被作为进程来实现的,运行在用户态,客户与服务器之间是借助微内核提供的消息传递机制来实现信息交互的.

3) 应用"机制与策略分离"原理

在现代操作系统的结构设计中,经常利用"机制与策略分离"的原理来构造OS结构.所谓机制,是指实现某一功能的具体执行机构.而策略,则是在机制的基础上,借助于某些参数和算法来实现该功能的优化,或达到不同的功能目标.通常,机制处于一个系统的基层,而策略则处于系统的高层.在传统的OS中,将机制放在OS的内核的较低层,把策略放在内核的较高层次中.而在微内核操作系统中,通常将机制放在OS的微内核中.正因为如此,才有可能将内核做得很小.

4) 采用面向对象技术

微内核的基本功能

1) 进程(线程)管理

大多数的微内核OS,对于进程管理功能的实现,都采用"机制与策略分离"的原理.例如,为实现进程(线程)调度功能,须在进程管理中设置一个或多个进程(线程)优先级队列,能将指定优先级进程(线程)从所在队列中取出,并将其投入执行.由于这一部分属于调度功能的机制部分,应将它放入微内核中.应如何确定每类用户(进程)的优先级,以及应如何修改它们的优先级等,都属于策略问题,可将它们放入微内核外的进程(线程)管理服务器中.

2) 低级存储器管理

通常在微内核中,只配置最基本的低级存储器管理机制.如用于实现将用户空间的逻辑地址变换为内存空间的物理地址的页表机制和地址变换机制,这一部分是依赖于机器的,因此放入微内核.而实现虚拟存储器管理的策略,则包含应采取何种页面置换算法,采用何种内存分配与回收策略等,应将这部分放在微内核外的存储器管理服务器中去实现.

3) 中断和陷入处理

大多数微内核操作系统都是将与硬件紧密相关的一小部分放入微内核中处理.此时微内核的主要功能,是捕获所发生的中断和陷入事件,并进行相应的前期处理.如进行中断现场保护,识别中断和陷入的类型,然后将有关事件的信息转换成消息后,把它发送给相关的服务器.由服务器根据中断或陷入的类型,调用相应的处理程序来进行后期处理.

在微内核OS中是将进程管理,存储器管理以及I/O管理这些功能一分为二,属于机制的很小一部分放入微内核中,另外绝大部分放在微内核外的各种服务器中来实现.事实上,其中大多数服务器都比微内核大.这进一步说明了为什么能在采用客户/服务器模式后,还能把微内核做得很小的原因.

存在的问题

应当指出,在微内核OS中,由于采用了非常小的内核,以及客户/服务器模式和消息传递机制,这些虽给微内核OS带来了许多优点,但由此也使微内核OS存在着潜在的缺点.其中最主要的是,较之早期OS,微内核OS的运行效率有所降低.

效率降低的最主要的原因是,在完成一次客户对OS提出的服务请求时,需要利用消息实现多次交互和进行用户/内核模式及上下文的多次切换.

然而,在早期的OS中,用户进程在请求取得OS服务时,一般只需进行两次上下文的切换:一次是在执行系统调用后,由用户态转向系统态时,另一次是在系统完成用户请求的服务后,由系统态返回用户态时.

在微内核OS中,由于客户和服务器及服务器和服务器之间的通信,都需通过微内核,致使同样的服务请求至少需要进行四次上下文切换.第一次是发生在客户发送请求消息给内核,以请求取得某服务器特定的服务时,第二次是发生在由内核把客户的请求消息发往服务器时,第三次是当服务器完成客户请求后,把响应消息发送到内核时,第四次是在内核将响应消息发送给客户时.

实际情况是往往还会引起更多的上下文切换.例如,当某个服务器自身尚无能力完成客户请求,而需要其它服务器的帮助时,其中的文件服务器还需要磁盘服务器的帮助,这时就需要进行八次上下文的切换.

# 进程管理与死锁
## 进程和线程的资源
一个标准的线程由线程ID,当前指令指针(PC),寄存器集合和堆栈组成.

另外,线程是进程中的一个实体,是被系统独立调度和分派的基本单位,线程自己不拥有系统资源,只拥有一点在运行中必不可少的资源,但它可与同属一个进程的其它线程共享进程所拥有的全部资源.

进程的资源虚拟地址空间,全局变量, 已代开文件, 定时器, 信号量等操作系统资源

### 用户级线程的实现
运行时系统(runtime system)

所谓运行时系统, 实质上是用于管理和控制线程的函数(过程)的集合, 其中包括创建和撤销线程的函数, 线程同步和通信的函数以及实现线程调度的函数等.

正因为这些函数, 才能使用户级线程与内核无关.

运行时系统中的所有函数都驻留在用户空间, 并作为用户级线程与内核之间的接口.

系统资源都是由内核管理的.

在传统的OS中, 进程是利用OS提供的系统调用请求系统资源的, 系统调用是通过软中断(trap)机制进入OS内核, 有内核完成相应资源的分配.

用户级线程是不能利用系统调用的. 当线程需要系统资源时, 是将该要求传送给运行时系统, 然后由后者通过相应的系统调用来获得系统资源的.

### 中断
软中断是利用硬件中断的概念,用软件方式进行模拟,实现宏观上的异步执行效果.很多情况下,软中断和"信号"有些类似,同时,软中断又是和硬中断相对应的,"硬中断是外部设备对CPU的中断","软中断通常是硬中断服务程序对内核的中断","信号则是由内核(或其他进程)对某个进程的中断"(<Linux内核源代码情景分析>第三章).

软中断是实现系统API函数调用的手段

函数调用时将返回地址和CPU状态寄存器内容压栈,函数执行完毕后出栈返回断点继续执行.

软中断调用时将返回地址和CPU状态寄存器内容压栈,修改特权级,根据中断号查找中断向量表,找到ISR中断服务例程地址,跳转执行.

综上,函数调用和软中断调用的区别是,软中断多了修改特权级和查找中断向量表的功能,其他部分完全一样.

一般,系统程序由软件公司实现且不开源,你无法知道系统API函数的偏移地址,而且你写的应用程序和软件公司提供的系统程序是完全分开的,编译器无法将二者链接在一起,同时,系统程序需要核心态特权才能运行,此时用函数调用的办法是无法调用系统API函数的.解决这个问题的方法是使用软中断,当应用程序需要调用API时,就先设置功能号(如AX=0H),然后触发软中断(如INT 80H).系统程序设置好中断向量表.这样,应用程序就可以间接找到系统API了.

内核控制线程

A light-weight process (LWP) is a means of achieving multitasking. In the traditional meaning of the term, as used in Unix System V andSolaris, a LWP runs in user space on top of a single kernel thread and shares its address space and system resources with other LWPs within the same process. Multiple user level threads, managed by a thread library, can be placed on top of one or many LWPs - allowing multitasking to be done at the user level, which can have some performance benefits.

用户级线程连接到LWP上, 便具有了内核支持线程的所有属性

# 处理机调度
优先数算法

轮转法

响应时间: 是从用户通过键盘提交一个请求开始, 直到系统首次产生响应为止的时间. 或者说, 直到屏幕上显示出结果为止的一段时间间隔.

它包括三部分时间: 从键盘输入的请求信息传送到处理机的时间, 处理机队请求信息进行处理的时间, 以及将形成的响应信息回送到终端显示器的时间.

银行家算法

思索的检测与解除

# 存储器管理
基本分页存储管理方式

二级分页

Two level page table

# 文件管理
为了能对一个文件进行正确的存取,必须为文件设置用于描述和控制文件的数据结构,称之为"文件控制块(FCB)".File control block

文件管理程序可借助于文件控制块中的信息,对文件施以各种操作.文件与文件控制块一一对应,而人们把文件控制块的有序集合称为文件目录,即一个文件控制块就是一个文件目录项.通常,一个文件目录也被看做是一个文件,称为目录文件.

文件逻辑结构的类型

有结构文件: 记录式文件

       定长记录, 变长记录

       顺序文件, 索引文件, 索引顺序文件

       例如: 大量的数据姐欧股和数据库

无结构文件: 流式文件

       UNIX 系统中, 所有的文件都被看做是流式文件, 即使是有结构文件.

       例如: 大量的源程序, 可执行文件, 库函数

 

文件存储空间的管理

成组链接法 不懂

在UNIX系统中,将空闲块分成若干组,每100个空闲块为一组,每组的第一空闲块登记了下一组空闲块的物理盘块号和空闲块总数.如果一个组的第一个空闲块号等于0,则有特殊的含义,意味着该组是最后一组,即无下一个空闲块.

分配空闲块的时候,从前往后分配,先从第一组开始分配,第一组空闲的100块分完了,才进入第二组.

释放空闲块的时候正好相反,从后往前分配,先将释放的空闲块放到第一组,第一组满了,在第一组前再开辟一组,之前的第一组变成第二组.

# 操作系统接口
操作系统接口

用户接口

       联机用户接口: 交互

       脱机用户接口: 也称为批处理用户接口,  作业控制语言       不能实现交互

程序接口 API Application Programming Interface

网络用户接口

# 网络操纵系统

计算机广域网络

公用电话交换网

	SLIP 较早的一个协议, 只完成数据报的封装和传送

PPP 数据链路层协议 支持多种协议, 异/同步通信, 错误检测, 选项商定, 头部压缩

分组交换网

面向连接与面向无连接

帧中继网

ATM 网 (asynchronous transfer mode)异步传输模式

面向连接

交换方法与分组交换中的交换方法的区别

ATM 采用按时间片交换的方式

定长交换, 信元

硬件实现


网络互连

网桥: 同构LAN 的网络互连设备

帧的发送和接收

缓冲管理

协议转换

路由器:

当要互联的LAN 数目较多时, 或者是实现异构型LAN 的互联或实现LAN与WAN的互联

网络层实现互联

拆包和解包功能

路由选择

协议转换

分段和重新组装

网关

异构型网络



客户/服务器模式

两层结构的client/server 模式

三层结构的client/server 模式

客户机/ 中间层服务器(应用服务器)/后端服务器(数据服务器)

网络操作系统提供的服务

域名系统DNS

Domain name system

目录服务

       目录服务管理的对象

              物理设备

              网络服务

              用户



域名解析的图解

Email

用户向邮箱服务提供商申请的Email 地址, 实际上代表某主机上的某块磁盘空间的首地址, 该磁盘空间专门供用户存放往来的邮件

# 系统安全性
系统安全威胁的类型

拒绝服务(denial of server)

攻击者进行拒绝服务攻击,实际上让服务器实现两种效果:一是迫使服务器的缓冲区满,不接收新的请求,二是使用IP欺骗,迫使服务器把合法用户的连接复位,影响合法用户的连接

攻击者删除在某一网络上传送的所有数据包的方式, 使网络表现为拒绝接受某用户的数据

攻击者通过修改合法用户的名字, 使之成为非法用户, 从而使网络拒绝向该用户提供服务

修改信息(modification)

修改数据包中的协议控制信息, 使该数据包被传送到非指定的目标

也可修改数据包中的数据部分, 已改变传送到目标的消息内容

还可以修改协议控制信息中的数据包的序号, 以搅乱信息内容

 

加密算法的类型

按对称性分类

对称加密算法

       将易位法与置换法交替使用多次而形成乘积密码

非对称加密算法

按所变换明文的单位分类

       序列加密算法

              将明文P 看成连续的比特流或字符流

       分组加密算法

 

对称与非对称各有优缺点

对称速度快, 但是密钥管理困难; 而非对称速度慢, 但是密钥管理简单

实际中, 一种常用的方法是利用公开密钥技术(非对称加密)传递对称密钥, 而用对称密钥技术来对实际传输的数据进行加密和解密

 

基本加密方法

易位法

       按照一定的规则, 重新安排明文中的比特或字符的顺序, 而字符本身保持不变

置换法

       按照一定的规则, 用一个字符去替换另一个字符

 

认证技术

身份认证主要基于下述三种信息来认证

1.       所知 knowledge, 口令

2.       所有 possesses, 例如身份证, 信用卡等

3.       个人特征 characteristics, 指纹, 视网膜(256字节编码), 声音

基于物理标志的认证技术

磁卡

一般在磁条上有三条磁道, 每条磁道都可用来记录不同标准和不同数量的数据

磁道上有两种记录密度, 15bit/inch的低密度磁道与 210bit/inch 的高密度磁道

银行卡

IC卡

Integrated Circuit Card 

IC卡中可以装入CPU和存储器芯片

 

基于公开密钥的认证技术

Kerberos 身份认证协议

安全套阶层(SSL secure socket layer) 协议

安全电子交易(SET) 协议等

 

SSL

申请数字证书

SSL握手协议

       身份认证

       协商加密算法

       协商加密秘钥

 

访问控制技术

访问矩阵

# UNIX 系统内核结构

