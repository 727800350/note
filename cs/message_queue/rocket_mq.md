# [事务消息](https://help.aliyun.com/document_detail/43348.html)
- 事务消息: RocketMQ 提供类似XA或Open XA的分布式事务功能,通过消息队列RocketMQ版事务消息能达到分布式事务的最终一致.
- 半事务消息: 暂不能投递的消息,发送方已经成功地将消息发送到了RocketMQ 服务端,但是服务端未收到生产者对该消息的二次确认,此
  时该消息被标记成"暂不能投递"状态,处于该种状态下的消息即半事务消息.
- 消息回查: 由于网络闪断,生产者应用重启等原因,导致某条事务消息的二次确认丢失,RocketMQ 服务端通过扫描发现某条消息长期处于
  "半事务消息"时,需要主动向消息生产者询问该消息的最终状态(Commit或是Rollback),该询问过程即消息回查.

典型场景

在淘宝购物车下单时,涉及到购物车系统和交易系统,这两个系统之间的数据最终一致性可以通过分布式事务消息的异步处理实现.
在这种场景下,交易系统是最为核心的系统,需要最大限度地保证下单成功.而购物车系统只需要订阅消息队列RocketMQ版的交易订单消息,
做相应的业务处理,即可保证最终的数据一致性.

事务消息发送步骤如下:

1. 发送方将半事务消息发送至消息队列RocketMQ版服务端.
1. 消息队列RocketMQ版服务端将消息持久化成功之后,向发送方返回Ack确认消息已经发送成功,此时消息为半事务消息.
1. 发送方开始执行本地事务逻辑.
1. 发送方根据本地事务执行结果向服务端提交二次确认(Commit或是Rollback),服务端收到Commit状态则将半事务消息标记为可投递,订
  阅方最终将收到该消息,服务端收到Rollback状态则删除半事务消息,订阅方将不会接受该消息.

事务消息回查步骤如下:

1. 在断网或者是应用重启的特殊情况下,上述步骤4提交的二次确认最终未到达服务端,经过固定时间后服务端将对该消息发起消息回查.
1. 发送方收到消息回查后,需要检查对应消息的本地事务执行的最终结果.
1. 发送方根据检查得到的本地事务的最终状态再次提交二次确认,服务端仍按照步骤4对半事务消息进行操作.

